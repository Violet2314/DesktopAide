# 工作模式追踪功能验证清单

## 🔧 修复的问题

### 1. AppTracking页面错误修复
- ✅ 修复了 `state is not defined` 错误
- ✅ 正确解构 `currentSession` 从 useAppContext
- ✅ 更新所有引用从 `state.currentSession` 到 `currentSession`

## 📋 功能验证步骤

### 第一步：启动应用
1. 确保开发服务器正在运行
2. 应用应该能正常启动，不出现错误
3. 进入应用追踪页面，确认页面正常显示

### 第二步：测试工作模式
1. 进入工作模式设置页面
2. 选择"深度工作模式"（默认模式）
3. 确认"自动创建桌面"选项已启用
4. 点击"启动模式"按钮

### 第三步：验证追踪功能
1. 返回应用追踪页面
2. 应该看到新的"工作模式状态"卡片
3. 卡片应显示：
   - 绿色脉冲指示器
   - 专注时长（初始为 00:00:00）
   - 分心时长（初始为 00:00:00）
   - 专注率（初始为 0%）

### 第四步：测试时长记录
1. 保持在应用内几秒钟（应记录为专注时长）
2. 切换到其他应用（如浏览器、记事本等）
3. 等待几秒钟后返回应用
4. 观察时长数据是否正确更新

### 第五步：验证统计卡片
1. 检查统计卡片是否优先显示工作模式数据
2. "高效时长"应显示专注时长
3. "分心时长"应显示分心时长
4. "效率得分"应显示专注率

### 第六步：停止工作模式
1. 返回工作模式设置页面
2. 点击"停止模式"按钮
3. 返回应用追踪页面
4. 工作模式状态卡片应消失
5. 统计卡片应恢复显示基于应用分类的数据

## 🧪 数据验证

### 会话数据检查
运行测试脚本检查会话数据：
```bash
node test_work_mode_tracking.js
```

应该看到：
- 会话文件已创建
- 包含会话记录
- 专注时长和分心时长数据正确

### 预期行为
- **专注时长**：在应用内或工作模式启动的应用内的时间
- **分心时长**：在其他应用内的时间
- **专注率**：专注时长 / (专注时长 + 分心时长) * 100%

## 🎯 成功标准

### 界面显示
- ✅ 应用追踪页面正常加载，无错误
- ✅ 工作模式状态卡片在模式运行时显示
- ✅ 统计卡片优先显示工作模式数据
- ✅ 时长数据实时更新

### 功能逻辑
- ✅ 桌面切换检测正常工作
- ✅ 时长记录准确
- ✅ 数据持久化保存
- ✅ 模式启动/停止正常

### 数据准确性
- ✅ 专注时长正确记录
- ✅ 分心时长正确记录
- ✅ 专注率计算正确
- ✅ 会话数据保存完整

## 🐛 常见问题排查

### 如果工作模式状态卡片不显示
1. 确认工作模式已启动
2. 检查控制台是否有错误
3. 确认 `currentSession` 数据正确获取

### 如果时长不更新
1. 检查桌面追踪是否正常启动
2. 确认定时器正常运行
3. 查看控制台日志

### 如果数据不保存
1. 检查文件权限
2. 确认数据目录存在
3. 查看保存错误日志

## 📝 测试报告模板

```
测试时间：[填写时间]
测试环境：[Windows版本]

✅ 应用启动正常
✅ 工作模式启动成功
✅ 状态卡片显示正常
✅ 时长记录准确
✅ 数据保存成功
✅ 模式停止正常

问题记录：
[记录任何发现的问题]

建议改进：
[记录改进建议]
```
