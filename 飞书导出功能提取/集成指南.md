# 飞书多维表格导出功能 - 集成指南

## 📋 功能概述

本功能包提供了完整的飞书多维表格数据导出解决方案，包括：
- 应用使用数据导出
- 工作模式会话数据导出
- 汇总数据导出
- 自动定时导出
- 完整的用户界面

## 📁 文件结构

```
飞书导出功能提取/
├── 集成指南.md                    # 本文件
├── 飞书导出功能文件清单.md         # 完整文件清单
├── 核心服务文件/                  # 核心代码文件
│   ├── FeishuService.ts          # 飞书API服务
│   ├── DataExportManager.ts      # 导出管理器
│   ├── DataExport.tsx           # 前端页面组件
│   ├── DataExport.css           # 页面样式
│   └── electron.d.ts            # TypeScript类型定义
├── 测试文件/                     # 测试和验证脚本
│   ├── test_feishu_export.js    # 主要测试脚本
│   ├── test_*.js               # 其他测试脚本
│   └── verify_*.js             # 验证脚本
└── 文档文件/                     # 完整文档
    ├── FEISHU_EXPORT_SUCCESS.md # 功能实现报告
    ├── SUMMARY_EXPORT_GUIDE_FINAL.md # 使用指南
    └── *.md                     # 其他技术文档
```

## 🚀 快速集成步骤

### 1. 复制核心文件

#### 后端服务文件
```bash
# 复制到你的项目中
src/main/services/FeishuService.ts
src/main/services/DataExportManager.ts
```

#### 前端界面文件
```bash
# 复制到你的项目中
src/renderer/src/pages/DataExport.tsx
src/renderer/src/pages/DataExport.css
```

#### 类型定义文件
```bash
# 合并到你的类型定义文件中
src/renderer/src/types/electron.d.ts
```

### 2. 安装依赖

确保你的项目包含以下依赖：

```json
{
  "dependencies": {
    "axios": "^1.6.0",
    "@fortawesome/react-fontawesome": "^0.2.0",
    "@fortawesome/free-solid-svg-icons": "^6.5.0"
  }
}
```

### 3. 主进程集成

在你的主进程文件中添加以下代码：

```typescript
import { DataExportManager } from './services/DataExportManager'

let dataExportManager: DataExportManager

// 在应用初始化时
dataExportManager = new DataExportManager(appTracker, workModeManager)

// 添加IPC处理程序
ipcMain.handle('set-feishu-config', async (event, config: any) => {
  return dataExportManager.setFeishuConfig(config)
})

ipcMain.handle('get-export-config', async () => {
  return dataExportManager.getConfig()
})

ipcMain.handle('test-feishu-connection', async () => {
  return dataExportManager.testFeishuConnection()
})

ipcMain.handle('export-today-data', async () => {
  return dataExportManager.exportTodayData()
})

ipcMain.handle('export-history-data', async (event, days: number) => {
  return dataExportManager.exportHistoryData(days)
})

ipcMain.handle('enable-auto-export', async (event, intervalHours: number) => {
  return dataExportManager.enableAutoExport(intervalHours)
})

ipcMain.handle('disable-auto-export', async () => {
  return dataExportManager.disableAutoExport()
})

ipcMain.handle('get-export-status', async () => {
  return dataExportManager.getExportStatus()
})

ipcMain.handle('export-app-usage-summary', async (event, date?: string) => {
  return dataExportManager.exportAppUsageSummary(date)
})
```

### 4. 路由配置

在你的前端路由中添加数据导出页面：

```typescript
import DataExport from './pages/DataExport'

// 在路由配置中添加
{
  path: '/data-export',
  component: DataExport
}
```

### 5. 导航菜单

在侧边栏或导航菜单中添加数据导出入口：

```tsx
<NavLink to="/data-export">
  <FontAwesomeIcon icon={faCloudUpload} />
  数据导出
</NavLink>
```

## ⚙️ 配置说明

### 飞书应用配置

你需要在飞书开放平台创建应用并获取以下信息：

```typescript
interface FeishuConfig {
  appId: string        // 应用ID
  appSecret: string    // 应用密钥
  appToken: string     // 多维表格Token
  tableId: string      // 应用详细数据表ID
  summaryTableId: string // 汇总数据表ID
  blockTypeId: string  // 块类型ID
}
```

### 数据表结构

#### 应用详细数据表字段
- 应用名称 (文本)
- 使用时长 (数字)
- 日期 (数字)
- 占比 (数字)

#### 汇总数据表字段
- 总时长 (数字)
- 专注时长 (数字)
- 分心时长 (数字)
- 效率得分 (数字)

## 🔧 依赖服务

此功能需要以下服务支持：

### AppTracker服务
```typescript
interface AppTracker {
  getUsageData(date: string): DayStats | null
}
```

### WorkModeManager服务
```typescript
interface WorkModeManager {
  getSessionHistory(days: number): WorkModeSession[]
}
```

## 🧪 测试验证

### 1. 运行基础测试
```bash
node test_feishu_export.js
```

### 2. 验证表格配置
```bash
node verify_table_ids.js
```

### 3. 测试数据导出
```bash
node test_app_usage_summary.js
```

## 📚 使用文档

详细的使用说明请参考：
- `FEISHU_EXPORT_SUCCESS.md` - 功能实现报告
- `SUMMARY_EXPORT_GUIDE_FINAL.md` - 完整使用指南
- `FEISHU_EXPORT_GUIDE.md` - 配置和使用说明

## 🔍 故障排查

### 常见问题

1. **连接失败**
   - 检查网络连接
   - 验证飞书应用配置
   - 确认表格权限

2. **导出失败**
   - 检查数据格式
   - 验证表格字段
   - 查看错误日志

3. **自动导出不工作**
   - 确认自动导出已启用
   - 检查导出间隔设置
   - 验证应用运行状态

### 调试工具

使用提供的调试脚本：
```bash
node debug_feishu_api.js
```

## 📞 技术支持

如果在集成过程中遇到问题：

1. 查看完整的文档文件
2. 运行测试脚本验证配置
3. 检查控制台错误日志
4. 参考示例代码和配置

## 🎯 功能特性

### ✅ 核心功能
- ✅ 飞书API集成
- ✅ 多种数据导出类型
- ✅ 自动定时导出
- ✅ 批量数据处理
- ✅ 错误处理和重试
- ✅ 现代化UI界面
- ✅ 完整的类型定义

### 🔧 技术特点
- TypeScript类型安全
- 异步数据处理
- 访问令牌自动管理
- 本地配置存储
- 玻璃态UI设计
- 响应式布局

### 📱 用户体验
- 直观的配置界面
- 一键导出操作
- 实时状态反馈
- 详细结果显示
- 自动导出调度

## 🎉 集成完成

按照以上步骤完成集成后，你的应用将具备完整的飞书多维表格数据导出功能。用户可以：

1. 配置飞书连接
2. 导出各种类型的数据
3. 设置自动导出
4. 在飞书中查看和分析数据

---

*此集成指南提供了完整的集成步骤和配置说明，确保功能能够顺利集成到你的项目中。*